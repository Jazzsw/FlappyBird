<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <title>Flappy Bird</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <h2 id = 'score'>Score: 0</h2>
    <div id='container'>
        <div id="sprite"></div>
        <button id="start">Start Game</button>

        <div id="death_popup">
        <h2 id ='deathMsg'>GAME OVER!</h2>
        <h3 id="enterName">Enter name to save score</h3>
        <input type="text" id="username" placeholder = "Username"></input><button id="submit_score">Save</button>
        <button id ="replay">Play Again</button>
    </div>
    </div>
    
    <div id= 'score_div' class="radio">
        <h2 id="scorename">Scores</h2>
        <input label="Easy" type="radio" id="easy" name="mode" checked>
        <input label="Challenging" type="radio" id="hard" name="mode">
        <div id="scoreboard_easy">
            </div>
            <div id="scoreboard_hard">
        </div>
    </div>


<!-- chalange select -->
        <div class="radio2">
            <input label="Easy" type="radio" id="mode_easy" name="mode2" checked>
            <input label="Challenging" type="radio" id="mode_hard" name="mode2">
        </div>
   
      

    <script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.2/firebase-database.js"></script>

    <script>
    const firebaseConfig = {
  apiKey: "AIzaSyBNSiRO5XRUBz_MKA5F1HiUrxoUypL1mPw",
  authDomain: "flappy-scores.firebaseapp.com",
  databaseURL: "https://flappy-scores-default-rtdb.firebaseio.com",
  projectId: "flappy-scores",
  storageBucket: "flappy-scores.appspot.com",
  messagingSenderId: "916803610806",
  appId: "1:916803610806:web:a1d8b677fd9a283eb29e17",
  measurementId: "G-BP1VNFCNT1"
};
   
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
    </script>

    <script>

if (window.innerWidth <= 800){
    document.getElementById("easy").style.width = "50%";
    document.getElementById("easy").style.fontSize = "20%";
    document.getElementById("hard").style.width = "50%";
    document.getElementById("hard").style.fontSize = "20%";
   
}


var FrameWidth = window.innerWidth
var width = FrameWidth*0.75

        const C_HEIGHT = 500;
        const C_WIDTH = width;
        const S_START_Y = 500 / 2;
        const S_START_X = C_WIDTH / 3;
        const S_WIDTH = 50;
        const S_HEIGHT = 50;
        const PIPE_WIDTH = 100;
        const ALL_PIPES = []
        const CLOSE_PIPES =[]
        score = 0;
        dead = 'false'

        document.getElementById('scoreboard_hard').style.display = 'none'//=====

        function sprite_init() {
            var death_msg = document.getElementById('deathMsg')
            death_msg.style.display= 'none'
            var replay = document.getElementById('replay')
            replay.style.display = 'none'
            var death_popup = document.getElementById('death_popup')
            death_popup.style.display = 'none'

            let sprite = document.getElementById("sprite");
            sprite.style.top = S_START_Y + "px";
            sprite.style.left = S_START_X + "px";

            
            let grass = document.createElement('div')
            grass.style.position = 'absolute'
            grass.style.height = "10px"
            grass.style.width = '100%';
            grass.style.bottom = '0px'
            grass.style.left = '0px'
            grass.style.background = "#68507B"
            container.appendChild(grass)
            

            let roof = document.createElement('div')
            roof.style.position = 'absolute'
            roof.style.width = '100%';
            roof.style.height = "10px"
            roof.style.background = "#68507B"
            container.appendChild(roof)
            roof.style.top = '0px';

        }

        function gravity_init(mod) {
            let sprite = document.getElementById("sprite");
            let pos_y = S_START_Y;
            let interval = setInterval(function () {
                if (pos_y < C_HEIGHT - S_HEIGHT - 10 && pos_y > 10) {
                    pos_y = parseInt(sprite.style.top) + mod;
                    sprite.style.top = pos_y + "px";
                }else{
                    clearInterval(interval)
                    dead = "true"
                    return;
                }
            }, 100)
        }

        function fly_jump_init(mod){
            let sprite = document.getElementById("sprite");
            
            document.addEventListener("keydown",function(e){
                if(e.which == 32){
                    sprite.style.top = parseInt(sprite.style.top) - mod + "px";
                }
            })

            document.addEventListener("touchstart",function(){
                sprite.style.top = parseInt(sprite.style.top) - mod + "px";
            })
        }

        function pipes_init(){
            let pipe_btm = document.createElement('div')
            let pipe_top = document.createElement('div')
            pipe_btm.style.position = 'absolute'
            pipe_top.style.position = 'absolute'
            pipe_top.style.background = "#68507B";
            pipe_btm.style.background = "#68507B";
            pipe_top.style.left= C_WIDTH + "px"
            pipe_btm.style.left = C_WIDTH + "px"
            pipe_top.style.width= PIPE_WIDTH + "px"
            pipe_btm.style.width = PIPE_WIDTH + "px"
            let container = document.getElementById('container')
            container.appendChild(pipe_btm)
            container.appendChild(pipe_top)
            let gap = 4*S_HEIGHT;


            

            let gap_pos = Math.floor(Math.random()*(C_HEIGHT-gap))
            let pipe_btm_pos_top = C_HEIGHT - gap_pos;
            let pipe_btm_height = C_HEIGHT - pipe_btm_pos_top;
            let pipe_top_pos_btm = gap_pos + gap;

            pipe_btm.style.height= gap_pos + 'px';
            pipe_btm.style.top= C_HEIGHT - gap_pos + 'px';


            pipe_top.style.height = (C_HEIGHT - gap_pos) - gap + "px"
            return [pipe_btm, pipe_top]
        }


        function pipes_road(speed){

            let pipes = pipes_init()

            ALL_PIPES.push(pipes)
    
           let pipe_btm = pipes[0]
           let pipe_top = pipes[1]

            let interval = setInterval(function(){
                pipe_btm.style.left = parseInt(pipe_btm.style.left)-1 +'px';
                pipe_top.style.left = parseInt(pipe_top.style.left)-1 + 'px';
                if (parseInt(pipe_top.style.left) == -100){
                    clearInterval(interval)
                    ALL_PIPES.shift()
                    pipe_btm.remove()
                    pipe_top.remove()
                }
            },speed)
        }

        function is_death(){
            let sprite_left = S_START_X
            let sprite = document.getElementById("sprite");

            let interval = setInterval(function(){
                let sprite = document.getElementById("sprite");
            
                for (let i =0; i<ALL_PIPES.length; i++){
                    danger = 'false'
    
                    if(parseInt(ALL_PIPES[i][0].style.left) < S_START_X + S_WIDTH && parseInt(ALL_PIPES[i][0].style.left) + PIPE_WIDTH > S_START_X){
                      danger = 'true'  
                    }

                    if (danger=="true"){

                       if(parseInt(sprite.style.top) <= parseInt(ALL_PIPES[i][1].style.height) || parseInt(sprite.style.top) +S_HEIGHT >= parseInt(ALL_PIPES[i][1].style.height) + (4*S_HEIGHT)){ 
                           dead = "true"
                           sprite.style.display = 'none'
                       }
                    }
                }
            },10)
        }


function scoreCount(){
    let interval = setInterval(function(){
                        scoreBord = document.getElementById('score')
                        score = score+1
                        scoreBord.innerHTML = ("Score: " + score)
                  
                if (dead=="true"){
                    clearInterval(interval)
                    var death_msg = document.getElementById('deathMsg')
                    var replay = document.getElementById('replay')
                    var death_popup = document.getElementById('death_popup')
                    death_popup.style.display = 'block'
                    death_msg.style.display= 'block'
                    replay.style.display ='block'   
                }

                },400)                
}





sprite_init();

document.getElementById('start').addEventListener('click',function(){

    document.getElementById('start').style.display = 'none'

    if (document.getElementById('mode_easy').checked){
        gravity_init(10);
        fly_jump_init(30);
        scoreCount();
        pipes_road(10)
        is_death()

        let interval = setInterval(function(){
        pipes_road(10)
        },3000)

    }else if(document.getElementById('mode_hard').checked){
        gravity_init(20);
        fly_jump_init(50);
        pipes_road(2)
        scoreCount();
        is_death()

        let interval = setInterval(function(){
        pipes_road(2)
        },1500)

    }


    })


document.getElementById('replay').addEventListener('click',function(){
window.location.reload()
    })




document.getElementById('submit_score').addEventListener('click',function(){

let name = document.getElementById('username').value;
let scoreNum = score




if (document.getElementById('mode_easy').checked){
    database.ref("/easy").push({
        data: {
            username: name,
            score: scoreNum,
        }
    })
   
    
}else if(document.getElementById('mode_hard').checked){
    database.ref("/hard").push({
        data: {
            username: name,
            score: scoreNum,
        }
    })
}
console.log(name + " got a score of "+ scoreNum)
})




function scoreboard(){

    var scores_easy = []
    var names_easy = []
    var scores_hard = []
    var names_hard = []

let interval = setInterval(function(){
    if(document.getElementById('hard').checked){
       document.getElementById('scoreboard_hard').style.display = "block"
       document.getElementById('scoreboard_easy').style.display = "none"
    }else if(document.getElementById('easy').checked){
       document.getElementById('scoreboard_easy').style.display = "block"
       document.getElementById('scoreboard_hard').style.display = "none"
    }

},200);

//=====EASY=======
    database.ref("/easy").once('value',function(snapshot){
        var obj = snapshot.val()
        var keysArr = (Object.keys(obj))
        var length = keysArr.length

        for (i=0; i<length; i++) {
            object = (obj[keysArr[i]])
            raw = (object.data)
            scores_easy.push(raw.score)
        }
        for (i=0; i<length; i++) {
            object = (obj[keysArr[i]])
            raw = (object.data)
            names_easy.push(raw.username)
        }


    var len = scores_easy.length;
   for (var i = len-1; i>=0; i--){
     for(var j = 1; j<=i; j++){
       if(scores_easy[j-1]<scores_easy[j]){
           var temp = scores_easy[j-1];
           var temp2 = names_easy[j-1]
           scores_easy[j-1] = scores_easy[j];
           names_easy[j-1] = names_easy[j];
           scores_easy[j] = temp;
           names_easy[j] = temp2;
        }
     }
   }

   for (i=0; i<10; i++){
    var name_score = document.createElement('h5')
    var txtNode = document.createTextNode((i+1)+ '. '+ names_easy[i]+' - Score: ' + scores_easy[i])
    name_score.appendChild(txtNode)
    document.getElementById('scoreboard_easy').appendChild(name_score)

    if (i==0){
        name_score.style.color = '#28193D'
        name_score.style.fontSize = '20px'
    }
   }


   var top_100_easy = document.createElement('select')
   document.getElementById('scoreboard_easy').appendChild(top_100_easy)

   var show_more = document.createElement('option')
   var show_text = document.createTextNode('Show More')
   show_more.appendChild(show_text)
   top_100_easy.appendChild(show_more)

   for (i=10; i<100; i++){

    var name_score = document.createElement('option')
    var txtNode = document.createTextNode((i+1)+ '. '+ names_easy[i]+' - Score: ' + scores_easy[i])
    name_score.appendChild(txtNode)
    top_100_easy.appendChild(name_score)

    
   }

       //=== ====== easy=====
})


//=============HARD============
database.ref("/hard").once('value',function(snapshot){
        var obj = snapshot.val()
        var keysArr = (Object.keys(obj))
        var length = keysArr.length

        for (i=0; i<length; i++) {
            object = (obj[keysArr[i]])
            raw = (object.data)
            scores_hard.push(raw.score)
        }
        for (i=0; i<length; i++) {
            object = (obj[keysArr[i]])
            raw = (object.data)
            names_hard.push(raw.username)
        }


    var len = scores_hard.length;
   for (var i = len-1; i>=0; i--){
     for(var j = 1; j<=i; j++){
       if(scores_hard[j-1]<scores_hard[j]){
           var temp = scores_hard[j-1];
           var temp2 = names_hard[j-1]
           scores_hard[j-1] = scores_hard[j];
           names_hard[j-1] = names_hard[j];
           scores_hard[j] = temp;
           names_hard[j] = temp2;
        }
     }
   }

   for (i=0; i<10; i++){
    var name_score = document.createElement('h5')
    var txtNode = document.createTextNode((i+1)+ '. '+ names_hard[i]+' - Score: ' + scores_hard[i])
    name_score.appendChild(txtNode)
    document.getElementById('scoreboard_hard').appendChild(name_score)

    if (i==0){
        name_score.style.color = '#28193D'
        name_score.style.fontSize = '20px'
    }
    
   }


   var top_100_hard = document.createElement('select')
   document.getElementById('scoreboard_hard').appendChild(top_100_hard)

   var show_more = document.createElement('option')
   var show_text = document.createTextNode('Show More')
   show_more.appendChild(show_text)
   top_100_hard.appendChild(show_more)

   for (i=10; i<100; i++){

    var name_score = document.createElement('option')
    var txtNode = document.createTextNode((i+1)+ '. '+ names_hard[i]+' - Score: ' + scores_hard[i])
    name_score.appendChild(txtNode)
    top_100_hard.appendChild(name_score)
   }
    

    })













}





      scoreboard()  

    </script>
</body>

</html>